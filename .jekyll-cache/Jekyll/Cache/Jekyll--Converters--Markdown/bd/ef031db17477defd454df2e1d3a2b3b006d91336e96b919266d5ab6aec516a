I"õ5<p><img src="{{site.url}}/assets/images/post/system_polling2.png" alt="system_polling_php" /><br />
<img src="{{site.url}}/assets/images/post/system_polling3.png" alt="system_polling_php" /> 
<img src="{{site.url}}/assets/images/post/system_polling4.png" alt="system_polling_php" /> 
<img src="{{site.url}}/assets/images/post/system_polling5.png" alt="system_polling_php" /></p>

<h1 id="hai-coders">hai coders!‚Ä¶</h1>
<p>bagaimana keadaanya semua, ditengah <strong>pandemi</strong> yang sedang melanda ini,<br />
semoga kita semua selalu dalam lindungan allah, dan selalu di berikan nikmat sehat dan nikmat waktu luang untuk menjaga kesehatan.</p>

<p>baiklah, kali ini saya mau iseng-iseng sedikit (..‚Äùiseng ko sedikit‚Äù) ‚Ä¶ lanjut.<br />
iseng-iseng saya kali ini adalah membuat system polling sederhana yang sangat simple dan sederhana dengan php dan database mysql.</p>

<p>langsung ajah yuk , kita mulai coding ‚Ä¶.</p>
<h1 id="pertama">pertama</h1>
<p>kita siapkan dulu database untuk menampung value pollingnya‚Ä¶<br />
masuk ke terminal atau cmd di windows, akses root ke aplikasi database nya disini saya menggunakan mysql
<em>terminal</em></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p
#masukan password root login anda
#lanjut buat database

create database polling;
use polling;

create table polling ( id int(11) primary key auto_increment, framework varchar(100) not null, value int(11) yes null );
describe polling;
</code></pre></div></div>
<p><img src="{{site.url}}/assets/images/post/system_polling_database.png" alt="database_polling_php" /><br />
databse telah selesai dibuat, lanjut coding program nya yuk ah ‚Ä¶.</p>

<h1 id="kedua">kedua</h1>
<p>siapkan directory di htdoc webserver kalian bebas untuk memberikan nama direktorinya.
kemudian buat beberapa file baru di direktori kalian,</p>
<ol>
  <li>index.php</li>
  <li>config.php</li>
  <li>functions.php</li>
</ol>

<p>file utama kita adalah index.php, sedangkan file function.php berperan sebagai file action untuk program systemnya. dan file config merupakan constant untuk configurasi database programm kita kali ini.  Dan untuk update artikel kali ini saya menggunakan teknik PDO (PHP data object), dan kali ini saya menggunakan framework css materialize. 
susunan file nya, direktori nya saya beri nama system_polling :<br />
<img src="{{site.url}}/assets/images/post/system_polling_direktori.png" alt="direktori_polling_php" /></p>

<h3 id="buat-file-configphp">buat file config.php</h3>
<p><em>kemudian copy code di bawah ini</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '1');
define('DB_NAME', 'polling'); 

</code></pre></div></div>

<h3 id="lanjut-buat-file-functionsphp">lanjut buat file functions.php</h3>
<p><strong>copy code di bawah ini</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
&lt;?php
require_once 'config.php';

function html($direktori, $layout, $ext='.ext', $title){
  global $dir;

  if(file_exists($dir.'/'.$layout.$ext)){
    $title = ($layout === 'footer') ? '' : $title;
    require_once $dir.'/'.$layout.$ext;
  }else{
    echo "&lt;h1 class='red-text'&gt;Layout not found&lt;/h1&gt;";
  }
}

function connect(){
  $server = DB_HOST;
  $user = DB_USER;
  $pass = DB_PASS;
  $db = DB_NAME;

  try{
    $conn = new PDO("mysql:host=$server; dbname=$db", $user, $pass);
    $conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::
      ERRMODE_EXCEPTION);
    return $conn;
    // echo "Connection sucessfully";

  }catch(PDOException $e){
    echo "Connection failed :".$e-&gt;getMessage();
  }
}

function framework($query){
  $dbh = connect();
  $result = $dbh-&gt;prepare($query);
  $result-&gt;execute();

  $rows=[];
  while($row = $result-&gt;fetch(PDO::FETCH_OBJ)):
    $rows[] = $row;
  endwhile;

  return json_encode($rows);
}

function polling($data, $table){
  $framework = @$data['framework'];

  $dbh = connect();
  $dbh-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  $sql = "UPDATE `$table` SET value = value+1 WHERE `framework` = '$framework'";
  $stmt = $dbh-&gt;prepare($sql);
  $stmt-&gt;bindParam(':value', $framework);
  $stmt-&gt;execute();
  return $stmt-&gt;rowCount();
}

function resetPolling($data){
  $framework = @$data['framework'];

  $dbh = connect();
  $sql = "UPDATE `framework` SET value = 0/value, win = win+1 WHERE `framework` = '$framework'";
  $stmt = $dbh-&gt;prepare($sql);
  $stmt-&gt;bindParam(':value', $framework);
  $stmt-&gt;bindParam(':total', $framework);
  $stmt-&gt;execute();
  return $stmt-&gt;rowCount();
}
</code></pre></div></div>
<p><strong><em>Copy code dibawah simpan ke file dengan nama <code class="language-plaintext highlighter-rouge">index.php</code></em></strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php require_once 'functions.php'; $dir='contents'; ?&gt;  
&lt;!DOCTYPE html&gt;
  &lt;html&gt;
    &lt;head&gt;
      &lt;!--Import Google Icon Font--&gt;
      &lt;link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"&gt;
      &lt;!--Import materialize.css--&gt;
      &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css"&gt;
      &lt;link rel="stylesheet" type="text/css" href="assets/style.css"&gt;
      &lt;link rel="stylesheet" type="text/css" href="assets/package/dist/sweetalert2.min.css"&gt;
      &lt;link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css"&gt;
      &lt;!--Let browser know website is optimized for mobile--&gt;
      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"/&gt;

      &lt;title&gt;Polling css framework&lt;/title&gt;
    &lt;/head&gt;

    &lt;div id="polling"&gt;
      &lt;?php html($dir, 'polling', '.php', 'Polling Framework css'); ?&gt;
    &lt;/div&gt;


    &lt;body&gt;
      &lt;!--Import jQuery before materialize.js--&gt;
      &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"&gt;&lt;/script&gt;
      &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"&gt;&lt;/script&gt;

      &lt;!-- sweet alert 2 --&gt;
      &lt;script src="assets/package/dist/sweetalert2.min.js"&gt;&lt;/script&gt;

      &lt;script type="text/javascript" src="assets/MyJs.js"&gt;&lt;/script&gt;

    &lt;/body&gt;
  &lt;/html&gt;

</code></pre></div></div>

<h3 id="buat-direktori-contents">Buat direktori contents</h3>
<p>direktori content ini akan menyimpan tampilan utama programm kita.<br />
<strong><em>buat file baru di direktori contents</em></strong></p>

<p>buat file dengan <code class="language-plaintext highlighter-rouge">polling.php</code>  kemudian copy code dibawah ini :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php 
$framework = json_decode(framework("SELECT * FROM `framework`"));
// var_dump($framework); 
// echo $framework[0]-&gt;value."&lt;br/&gt;&lt;br/&gt;";
// die;
?&gt;

&lt;div class="row"&gt;
  &lt;div class="col s6"&gt;
    &lt;h4&gt;Framework List : &lt;/h4&gt;
      &lt;ul&gt;
      &lt;?php foreach($framework as $f): ?&gt;

        &lt;li&gt;
          &lt;input class="polling-input with-gap" name="framework" value="&lt;?=$f-&gt;framework?&gt;" type="radio" id="&lt;?=$f-&gt;framework?&gt;"&gt;
          &lt;label for="&lt;?=$f-&gt;framework?&gt;"&gt;&lt;?=$f-&gt;framework?&gt;&lt;/label&gt;
        &lt;/li&gt;
      &lt;?php endforeach; ?&gt;
&lt;!--        &lt;li&gt;
          &lt;button class="polling-btn btn waves-effect waves-light" id="polling-btn"&gt;Polling
              &lt;i class="material-icons right"&gt;send&lt;/i&gt;
          &lt;/button&gt;
        &lt;/li&gt; --&gt;
      &lt;/ul&gt;
  &lt;/div&gt;


&lt;div id="view-data"&gt;
  
&lt;/div&gt;

</code></pre></div></div>
<p>dalam update artikel kali ini penulis menambahkan fungsi ajax sebagai metode request untuk meload data dari clientside tanpa mereload halaman secara keseluruhan :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$(document).ready(function(){

  $('#view-data').hide().load('contents/view_data.php').fadeIn(1000);

  $('input[type=radio]').on("click", function(e){
    const framework = $('input[name=framework]:checked').val();

    // alert(framework);

    switch(framework){
      case "Bootstrap":
      icon = 'bootstrap.png';
      break;
      case "Materialize":
      icon = 'materialize.png'
      break;
      case "Foundation":
      icon = 'foundation.png';
      break;
      case "Bulma":
      icon = 'bulma.png';
      break;
    }

    const value = $('#progress').attr('aria-valuenow');


    if(framework){
      $.ajax({
        url: 'contents/view_data.php?p=polling',
        type: 'post',
        data: 'framework='+framework,
        success: function(response){
          if(response){
            $('#view-data').load('contents/view_data.php').fadeIn(1000);

            $('input[type=radio]').prop("checked", false);
            swal.fire({
              title: framework,
              text: 'Your framework choice : '+framework,
              imageUrl: location.href+'/assets/images/'+icon,
              imageWidth: 150,
              imageHeight: 130,
              imageAlt: framework,
              timer: 2000
            });
          }else{
            swal.fire("Nothing framework selected");
            e.preventDefault();
          }
          
        }
      })
    }

    if(value &gt;= 99){
    $('#view-data').hide().load('contents/view_data.php').fadeIn(1000);
      $.ajax({
        url: 'contents/view_data.php?p=reset',
        type: 'post',
        data: 'framework='+framework,
        success: function(response){
          if(response){
              Swal.fire({
                title: framework+' is Winner &lt;i class="fas fa-medal"&gt;&lt;/i&gt;',
                text: framework+" has 100%",
                imageUrl: location.href+'/assets/images/'+icon,
                imageWidth: 150,
                imageHeight: 130,
                imageAlt: framework,  
                showCancelButton: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yeahh, next polling again!'
              }).then((result) =&gt; {
                if (result.value) {
                  Swal.fire(
                    'Ok !',
                    'See you next Polling',
                    location.href+'/assets/images/'+icon,
                  '150',
                  '130',
                  framework,
                  );
                  setTimeout(function(){
                    $('#view-data').load('contents/view_data.php').fadeIn(1000);
                  }, 1500);
                }
              })
            }
          }
      });
    }

  });
});


</code></pre></div></div>
<p>save code diatas dengan nama MyJs.js di direktori assets, secara keseluruhan code diatas akan meload halaman view yang telah direquest oleh clientside dan menampilkan keseluruhan data terupdate setelah query data selesai dilakukan oleh serverside :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php 
require_once '../functions.php';
$medal = '&lt;i class="fas fa-fw fa-lg fa-medal blue-text"&gt;&lt;/i&gt;';
if(@$_GET['p'] == 'polling'):
  if(polling($_POST, 'framework') &gt; 0):
    echo @$_POST['framework'];
  endif;
elseif(@$_GET['p'] == 'reset'):
  resetPolling(@$_POST);
  echo @$_POST['framework'];
else:
$framework = framework("SELECT * FROM `framework`");
$framework = json_decode($framework, true); 
//var_dump($framework); die;
?&gt;

  &lt;div class="col s6"&gt;
    &lt;h4&gt;Framework Polling&lt;/h4&gt;
  &lt;?php for($i=0; $i &lt;= count($framework[0])-1; $i++): ?&gt;
  &lt;div class="col s5"&gt;
    &lt;p class="orange-text"&gt;Win : &lt;?php for($j=1; $j &lt;= $framework[$i]['win']; $j++): echo $medal; endfor;?&gt; &lt;/p&gt;

  &lt;/div&gt;
    &lt;div class="tootltipped progress blue lighten-4" data-position="left" data-tooltip="I am a tooltip"&gt;&lt;/div&gt;
    &lt;span id="framework" data-name="&lt;?=$framework[$i]['framework']?&gt;"&gt;
      &lt;?=$framework[$i]['framework']?&gt;  
    &lt;/span&gt;
    &lt;div id="progress" class="determinate blue"  aria-valuenow="&lt;?=$framework[$i]['value']?&gt;" aria-valuemin="0" aria-valuemax="100" value="&lt;?=$framework[$i]['value']?&gt;" style="width: &lt;?=$framework[$i]['value']?&gt;%"&gt;&lt;?=$framework[$i]['value']?&gt;%
    &lt;/div&gt;
  &lt;?php endfor;?&gt;
  &lt;/div&gt;

&lt;?php endif; ?&gt;

</code></pre></div></div>
<p>save code diatas di direktori <code class="language-plaintext highlighter-rouge">contents/</code> dengan nama view_data.php. Alhasil setiap kali request dari clientside akan ditangani terlebih dahulu oleh metode ajax nya, ini bertujuan mengurangi resource load page ke server, dan membuat kerja server menjadi lebih cepat.</p>

<p>untuk file assets dan file lengkap lainnya bisa clone langsung atau download ke repository dibawah ini :<br />
<a href="https://github.com/codesyariah122/system_polling.git">System Polling </a></p>

<p>ok di setiap file di atas sudah saya beri sedikit penjelasan, mudah-mudahan bisa di mengerti yaa. mudah ko prinsip kerjanya sangat sederhana.</p>

<p>ok selamat mencoba.</p>
:ET