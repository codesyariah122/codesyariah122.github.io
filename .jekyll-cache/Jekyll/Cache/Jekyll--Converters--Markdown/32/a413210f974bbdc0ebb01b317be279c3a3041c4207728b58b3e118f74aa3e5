I"F<h3 id="membuat-reaction-button-dengan-jquery-ajax">Membuat reaction button dengan jquery ajax</h3>

<p><img src="http://localhost:4000/assets/images/post/crud_ajax_with_button_reaction.gif" alt="crud_ajax_with_button_reaction" /></p>

<p>halo para coders ! apa kabarnya ? â€¦<br />
mudah-mudahan kalian semua selalu diberikan nikmat sehat selalu.</p>

<p>ok dalam artikel kali ini gout mau membagikan tips and trick mungkin yah, hehehe. trick sederhana membuat reaction button kaya yang di medsos, medsos itu loh.<br />
tapi sebelum ke intinya, gout mau berbagi sedikit cerita. ini ada hubungannya dengan tujuan gout menulis artikel kali ini, karena berdasarkan pengalaman yang pernah gout alami. dari pengalaman tersebut yahh sekitar setahun yang lalu, gout sebagai web developer untuk sebuah perusahaan distributor kosmetik, dan disalah satu halaman webnya gout pasang sebuah button reaction untuk mendapatkan review dari pengalaman pengunjung setelah melihat-lihat list product, nah di aplikasi button reaction itu adalah pihak ketiga yang disediakan sebuah layanan media advertise online yaitu <a href="https://www.addthis.com/social-buttons/">Add this</a> , dari layanan button di media milik Add this itu, sayangnya belum bisa di custom secara bebas, fitur yang tersedia terbatas hanya yang mereka sediakan saja.</p>

<p>tapi sayangnya sibos gout pengen button yang sesuai dengan yang ia inginkan, dari tugas itulah gout terpaksa deh membuat custom button reaction sendiri dengan seadanya, dengan bahasa pemrogramman yang tersedia yaitu <code class="language-plaintext highlighter-rouge">php7.0</code> yah akhirnya ane mencoba untuk berkreasi sendiri, jadilah button reaction ini gout gabungkan dengan platform lainnya yah salah satunya adalah jquery dan ajax dari javasript.</p>

<p>nah berdasarkan kisah diatas, sekarang gout bermaksud mau berbagi pengalaman dan gout akan share sedikit tips dan trick tersebut. dalam artikel ini masih berkelanjutan dari artikel sebelumnya yang berjudul : <a href="https://codesyariah122.github.io/php/pdo/ajax/jquery/crud-data-dengan-jquery-ajax/">Membuat crud data dengan ajax jquery</a> di artikel yang terupdate kemaren yaitu penambahan fitur : <a href="https://codesyariah122.github.io/php/ajax/jquery/membuat-fitur-pagination-pada-aplikasi-crud-data-ajax-jquery/">Fitur Pagination</a>.  jadi di artikel ini kurang lebih source codenya masih sama, hanya mungkin ada sedikit perombakan dan penambahan file saja.
ok, kita langsung ajah mulai codingnya : 
pertama yang mengalami perubahan adalah table <code class="language-plaintext highlighter-rouge">product</code> di database utama kita yaitu database crudajax :</p>

<p>sekarang kita akses terminal kemudian masuk ke config database dari terminal dengan command :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p
-- kemudian gunakan databse crudajax
use crudajax;
-- lihat list table
show tables;
-- tambahkan column baru untuk menghubungkan table product dengan table yang nanti akan dibuat untuk menampung nilai reaction
alter table product add column id_react int(11) after product_price;
-- lihat kembali struktur table setelah penambahan column baru
describe product;
-- kemudian buat key untuk field id_react
ALTER TABLE `product` ADD KEY `id_react` (`id_react`);
-- ///////////////////////////////////////////////////////////////
-- sekarang kita buat table baru untuk fitur reaction di artikel kali ini
CREATE TABLE `reaction` (
  `id_react` int(11) NOT NULL,
  `love` int(11) DEFAULT NULL,
  `likes` int(11) DEFAULT NULL,
  `clapping` int(11) DEFAULT NULL,
  `cool` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
</code></pre></div></div>
<p>di command database diatas kita punya satu table baru yang akan terhubung ke field/column <code class="language-plaintext highlighter-rouge">id_reat</code> di table <code class="language-plaintext highlighter-rouge">product</code>. kemudian selanjutnya kita langsung buka code editor untuk mengubah beberapa codingan yang antara lain sebagai berikut :<br />
file pertama yang akan dirubah adalah file <code class="language-plaintext highlighter-rouge">contents/detail.php</code> , sehingga file tersebut gout rubah jadi seperti dibawah ini :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;style type="text/css"&gt;
  .polygon{
    clip-path: polygon(47% 41%, 75% 0%, 94% 49%, 75% 100%, 18% 78%, 0 30%);
  }
&lt;/style&gt;
&lt;?php  
require_once '../functions.php';
if(@$_GET['detail']):
  $dataId = @$_GET['detail'];
  $detailData = view("SELECT * FROM `product` WHERE `id` = '$dataId'");
endif;
?&gt;
&lt;?php foreach($detailData as $data): ?&gt;
  &lt;div class="row justify-content-center"&gt;
    &lt;div class="card" style="width: 18rem;"&gt;
      &lt;img id="setan" src="assets/images/&lt;?=$data['product_image']?&gt;" class="card-img-top polygon" alt="&lt;?=$data['product_name']?&gt;"&gt;
      &lt;div class="card-body"&gt;
        &lt;h3 class="text-primary"&gt;&lt;?=$data['product_name']?&gt;&lt;/h3&gt;
        &lt;p class="card-text"&gt;
          IDR - &lt;?=number_format($data['product_price'], 2)?&gt;
        &lt;/p&gt;
        &lt;p class="blockquote-footer"&gt;
          &lt;?=$data['product_description']?&gt;
        &lt;/p&gt;
        &lt;div id="reaction"&gt;
          &lt;input type="hidden" id="id_react" name="id_react" value="&lt;?=$data['id_react']?&gt;"&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;?php endforeach; ?&gt;


&lt;script type="text/javascript" src="assets/js/getReaction.js"&gt;&lt;/script&gt;
</code></pre></div></div>
<p>di file tersebut untuk javascript nya gout pisah ke file tersendiri sehingga file javascriptnya ada di direktori <code class="language-plaintext highlighter-rouge">assets/js/</code> dengan nama file <code class="language-plaintext highlighter-rouge">getReaction.js</code> , berikut code di file <code class="language-plaintext highlighter-rouge">getReaction.js</code> :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// file getReaction.js
$('#reaction').load('contents/reaction.php');
  // $('.polygon').mouseenter(function(){
 //       $(this).removeClass('polygon');
  // });
  // $('.polygon').mouseleave(function(){
  //  $(this).addClass('polygon');
  // })
var image = document.querySelector('.polygon')

image.addEventListener('mouseenter', function(){
  image.classList.remove('polygon');
});
image.addEventListener('mouseleave', function(){
  image.classList.add('polygon');
});


$(document).ready(function(){
  const reactId = $('input[type=hidden][name=id_react]').val();
  $.ajax({
    url: 'contents/reaction.php?react_id='+reactId,
    type: 'post',
    data: 'reactId='+reactId,
    success: function(response){
      if(response){
        $('#reactId').attr("value",reactId);
      }
    }
  })
})
</code></pre></div></div>
<p>kemudian di file berikutnya adalah file tambahan baru yang gout beri nama <code class="language-plaintext highlighter-rouge">reaction.php</code> di direktori <code class="language-plaintext highlighter-rouge">contents/reaction.php</code> berikut isi codingan file <code class="language-plaintext highlighter-rouge">reaction.php</code> :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php  require_once '../functions.php';?&gt;

&lt;style type="text/css"&gt;
  input[type="checkbox"]{
      display: none;
    }

    .emoji-label{
      cursor: pointer;
      font-size: 3rem;
      margin-left:0.3rem;
      margin-top:-1rem;
      animation: shake 0.5s;
        animation-iteration-count: infinite; 
    }
    .emoji-label:hover{
      -webkit-transform: scaleX(-1);
        transform: scaleX(-1);
        animation: shake 0.5s;
        animation-iteration-count: infinite; 
    }
    .display{
      display: none;
    }

&lt;/style&gt;
&lt;?php 
if(@$_GET['react_id']):
  $dataId = @$_GET['react_id']; 
endif; 
?&gt;

&lt;button class="btn btn-small btn-primary mb-3" id="react-onclick" onclick="emojiReact(emoji)"&gt;Push Reaction&lt;/button&gt;
&lt;br/&gt;
&lt;input type="hidden" name="reactId" id="reactId" value="&lt;?=@$_GET['react_id']?&gt;"&gt;

&lt;input type="checkbox" id="love" value="love" name="reactemoji" class="reaction"&gt;
&lt;label for="love" class="emoji-label display"&gt;love&lt;/label&gt;

&lt;input type="checkbox" id="likes" value="likes" name="reactemoji" class="reaction"&gt;
&lt;label for="likes" class="emoji-label display"&gt;like&lt;/label&gt;

&lt;input type="checkbox" id="clapping" value="clapping" name="reactemoji" class="reaction"&gt;
&lt;label for="clapping" class="emoji-label display"&gt;clapping&lt;/label&gt;

&lt;input type="checkbox" id="cool" value="cool" name="reactemoji" class="reaction"&gt;
&lt;label for="cool" class="emoji-label display"&gt;cool&lt;/label&gt;

&lt;div id="react-value"&gt;&lt;/div&gt;

&lt;script type="text/javascript" src="assets/js/reaction.js"&gt;&lt;/script&gt;

</code></pre></div></div>
<p>masih menggunakan fungsi yang sama, yang ada di file <code class="language-plaintext highlighter-rouge">functions.php</code> direktori root, aplikasi crud data ajax jquery.  di file <code class="language-plaintext highlighter-rouge">contents/reaction.php</code> tersebut file javascript nya juga gout pisah di direktori lain, sepertinya dalam artikel kali ini semua file javascript gout pisahkan ke direktori <code class="language-plaintext highlighter-rouge">assets/js</code> di file <code class="language-plaintext highlighter-rouge">reaction.php</code> ini file javascriptnya gout kasih nama <code class="language-plaintext highlighter-rouge">reaction.js</code> dan berikut isi codingan file <code class="language-plaintext highlighter-rouge">reaction.js</code> :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// file reaction.js
function emojiReact(emoji){
  document.getElementById('react-onclick').style.display='none';
  for(let i = 0; i&lt;=emoji.length-1; i++){
    $('.emoji-label').eq(i).html(emoji[i]);
    let emojiLabel = document.querySelector('.emoji-label')[i];
    $('.emoji-label').removeClass('display');
  }
}
emoji = ['ðŸ¥°', '&amp;#128077;', '&amp;#128079;&amp;#127996;', '&amp;#127882;'];

$(document).ready(function(){
  $('#react-value').load('contents/react_data.php');

  $('input[type=checkbox]').click(function(){
    const reactEmoji = $('input[name=reactemoji]:checked').val();
    const reactId = $('input[type=hidden][name=reactId]').val();
    if(reactEmoji){
      switch(reactEmoji){
        case "love":
        emoji = "ðŸ¥°";
        break;
        case "likes":
        emoji = "&amp;#128077;";
        break;
        case "clapping":
        emoji = "&amp;#128079;&amp;#127996;";
        break;
        case "cool":
        emoji = "&amp;#127882;";
        break;
      }
      $.ajax({
        url: 'contents/react_data.php?reactemoji='+reactEmoji+'&amp;reactid='+reactId,
        type: 'post',
        data: 'reactEmoji='+reactEmoji+'&amp;reactId='+reactId,
        success: function(response){
          if(response){
            //Swal.fire(response);
            Swal.fire("Your reaction : "+emoji);
            $('#react-value').html(response);
            $('input[name=reactemoji]').prop('checked', false);
          }
        }
      });
    }
  });
});
</code></pre></div></div>
<p>berikutnya adalah file <code class="language-plaintext highlighter-rouge">functions.php</code> di file tersebut perubahan yang gout tambahkan yakni di fungsi <code class="language-plaintext highlighter-rouge">addAjax(){}</code> , dan di fungsi tersebut juga gout bahas di artikel terakhir kemarin mengenai insert data ke 2 table berbeda dalam satu statement yaitu di artikel berikut : 
<a href="https://codesyariah122.github.io/php/ajax/jquery/Menjalankan-dua-query-berbeda-dalam-satu-statement-menggunakan-PDOExtention/">Menjalankan dua query berbeda dalam satu statement</a>.<br />
berikut fungsi <code class="language-plaintext highlighter-rouge">addAjax(){}</code> yang sudah gout ubah :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// file functions.php
function addAjax($data, $file, $table1, $table2){
  // var_dump(@$file);
  // var_dump(@$data);

  $dbh = connect();
  $productCode = @$data['productcode'];
  $productImage = upload($file, '../assets/images/');
  $productName = @$data['productname'];
  $productDesc = @$data['productdescription'];
  $productPrice = @$data['productprice'];

  if(!$productImage){
    $productImage = 'no-product-image.png';
  }

  $sql = "INSERT INTO `$table1` (id, product_code, product_image, product_name, product_description, product_price, id_react) VALUES ('', ?, ?, ?, ?, ?, '')";
  $insertProduct = $dbh-&gt;prepare($sql);

  $insertProduct-&gt;bindParam(1, $productCode);
  $insertProduct-&gt;bindParam(2, $productImage);
  $insertProduct-&gt;bindParam(3, $productName);
  $insertProduct-&gt;bindParam(4, $productDesc);
  $insertProduct-&gt;bindParam(5, $productPrice);

  $insertProduct-&gt;execute();
  
    // update id_react table product
  $lastId = $dbh-&gt;lastInsertId();
  $sql = "
    UPDATE `$table1` SET id_react = $lastId WHERE `id` = $lastId;
    INSERT INTO `$table2` (id_react, love, likes, clapping, cool) VALUES($lastId, '', '', '', '');
  ";
  $stmt = $dbh-&gt;prepare($sql);
  return $stmt-&gt;execute();

}
</code></pre></div></div>
<p>berikut ini fungsi lain yaitu fungsi untuk insert reaction dari buttonnya : gout beri nama fungsi <code class="language-plaintext highlighter-rouge">reactEmoji(){}</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// file functions.php
function reactEmoji($data, $table){
  $reactEmoji = @$data['reactemoji'];
  $reactId = @$data['reactid'];

  $dbh = connect();

  switch($reactEmoji){
    case "love":
      $sql = "UPDATE `$table` SET love=love+1 WHERE `id_react` = '$reactId'";
      $reaction = $dbh-&gt;prepare($sql);
      $reaction-&gt;execute();
      return $reaction-&gt;rowCount();
    break;

    case "likes":
      $sql = "UPDATE `$table` SET likes=likes+1 WHERE `id_react` = '$reactId'";
      $reaction = $dbh-&gt;prepare($sql);
      $reaction-&gt;execute();
      return $reaction-&gt;rowCount();
    break;

    case "clapping":
      $sql = "UPDATE `$table` SET clapping=clapping+1 WHERE `id_react` = '$reactId'";
      $reaction = $dbh-&gt;prepare($sql);
      $reaction-&gt;execute();
      return $reaction-&gt;rowCount();
    break;

    case "cool":
      $sql = "UPDATE `$table` SET cool=cool+1 WHERE `id_react` = '$reactId'";
      $reaction = $dbh-&gt;prepare($sql);
      $reaction-&gt;execute();
      return $reaction-&gt;rowCount();
    break;
  }
  
}
</code></pre></div></div>
<p>berikutnya adalah file yang gout beri nama <code class="language-plaintext highlighter-rouge">react_data.php</code> file tersebut berfungsi untuk menampung nilai value yang terlah mengalami update dari reaction yang telah di input di file <code class="language-plaintext highlighter-rouge">reaction.php</code> berikut ini isi codingan di file <code class="language-plaintext highlighter-rouge">react_data.php</code> :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// file contents/react_data.php
&lt;style type="text/css"&gt;
  .react-ul{
      display: flex;
      padding:2px;
      margin-top:-2rem;
    }
  .react-list{
      list-style: none;
      padding: 10px;
      font-size: 1.5rem;
    }
&lt;/style&gt;
&lt;?php
require_once '../functions.php';

if(@$_GET['reactemoji'] &amp;&amp; @$_GET['reactid']):
  reactEmoji(@$_GET, 'reaction');
$emoji = @$_GET['reactemoji'];
$idEmoji = @$_GET['reactid'];
$emojiValue = view("SELECT * FROM `reaction` WHERE `id_react` = $idEmoji")[0];
?&gt;
&lt;ul class="react-ul" class="ml-4"&gt;
  &lt;li class="react-list &lt;?=($emojiValue['love'] &gt; 1) ? 'text-primary' : 'text-danger';?&gt;"&gt;&lt;?=$emojiValue['love']?&gt;&lt;/li&gt;
  &lt;li class="react-list &lt;?=($emojiValue['likes'] &gt; 1) ? 'text-primary' : 'text-danger';?&gt;" style="margin-left:2rem;"&gt;&lt;?=$emojiValue['likes']?&gt;&lt;/li&gt;
  &lt;li class="react-list &lt;?=($emojiValue['clapping'] &gt; 1) ? 'text-primary' : 'text-danger';?&gt;" style="margin-left:2rem;"&gt;&lt;?=$emojiValue['clapping']?&gt;&lt;/li&gt;
  &lt;li class="react-list &lt;?=($emojiValue['cool'] &gt; 1) ? 'text-primary' : 'text-danger';?&gt;" style="margin-left:1.7rem;"&gt;&lt;?=$emojiValue['cool']?&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;?php endif; ?&gt;
</code></pre></div></div>
<p>file <code class="language-plaintext highlighter-rouge">react_data.php</code> tersebut akan diload hanya ketika saat button telah di click atau dengan kata lain ada event yang di minta lalu script akan mengirim query ke database dan kemudian nilai atau value di database di update dengan fungsi <code class="language-plaintext highlighter-rouge">reactEmoji(){}</code> di file <code class="language-plaintext highlighter-rouge">functions.php</code>. jadi file <code class="language-plaintext highlighter-rouge">react_data.php</code> ini menyajikan data dari value yang telah terupdate di database.</p>

<p>ok codingan yang mengalami perubahan hanya itu saja, untuk source code lengkap dapat kalian simak di link dibawah ini :<br />
<a href="https://github.com/codesyariah122/crud-data-with-php-PDO-Jquery-ajax/tree/with_react_button">crud ajax jquery dengan branch with_react_button</a>. akhir kata gout mengucapkan terima kasih kepada para pembaca, mudah2an bisa jadi manfaat dari artikel gout ini. akhir kata gout ucapkan.</p>

<p>waasalammâ€¦.</p>

<p><strong><em>puji ermanto</em></strong></p>

:ET