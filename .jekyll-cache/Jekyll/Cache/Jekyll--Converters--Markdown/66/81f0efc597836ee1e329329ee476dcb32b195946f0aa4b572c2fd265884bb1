I"iN<p>{{page.opening}}</p>

<p>Melanjutkan seri mengenai laravel sebelumnya, kali ini di artikel ini gout mau membahas  seputar migration di laravel. sebelumnya, apa kabarnya nih para coders ? mudah2an selalu di berkahi nikmat sehat dan nikmat waktu luang.</p>

<h3 id="migration-laravel">Migration Laravel</h3>
<p>Seperti yang sudah kita ketahui, bahwasanya laravel mempunya banyak sekali magic tools, dan salah satu dari magic tools tersebut akan gout bahas di artikel kali ini. Ok langsung ajah ke prakteknya.</p>

<h4 id="memulai-migration">Memulai migration</h4>

<p>Berdasarkan tutorial laravel sebelumnya yaitu di artikel ini <a href="https://codesyariah122.github.io/php/laravel/composer/git/docker/environment-development-dengan-laradock/" target="_blank">Deployment laravel application with Laradock</a></p>

<blcokquote> jadi artikel ini developmentnya melanjutkan seri artikel di link tersebut yah </blcokquote>

<p>Ok tanpa banyak basa basi, kita buka code editor kesayangan kita , bagi yang menggunakan visual studio code tidak perlu lagi membuka terminal CLI yah, berhubung kali ini gout pakai sublime jadi terpaksa harus buka terminal.</p>

<h4 id="aktifkan-laradock">Aktifkan laradock</h4>
<p>Buka terminal kemudian akses direktori project <strong>laradock</strong> nya.<br />
Masuk ke direktori project.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@debian:/home/puji122/laravel-projects# 
</code></pre></div></div>
<p>Kemudian pindah ke direktori <strong>laradock</strong> :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@debian:/home/puji122/laravel-projects# <span class="nb">ls</span> <span class="nt">-l</span>
total 16
drwxrwxrwx 74 root    root    4096 Jan  8 07:02 laradock
drwxrwxrwx 12 root    root    4096 Jan 10 12:11 projectku
<span class="nt">-rw-r--r--</span>  1 puji122 puji122 3403 Jan 11 21:46 README.md
<span class="nt">-rwxrwxrwx</span>  1 root    root     305 Dec 18 13:00 test_api.php
root@debian:/home/puji122/laravel-projects# <span class="nb">cd </span>laradock/
root@debian:/home/puji122/laravel-projects/laradock# 
</code></pre></div></div>
<p>perhatikan bagian <strong><em>root@debian:/home/puji122/laravel-projects/laradock#</em></strong> yup … kita sudah masuk ke direktori laradock kita.<br />
kemudian kita jalankan container laradocknya :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>docker-compose up <span class="nt">-d</span> nginx mysql phpmyadmin redis workspace
</code></pre></div></div>
<p>tunggu prosess nya sampai <strong><em>done</em></strong>.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@debian:/home/puji122/laravel-projects/laradock# docker-compose up -d nginx mysql phpmyadmin redis workspace
laradock_docker-in-docker_1 is up-to-date
laradock_mysql_1 is up-to-date
laradock_redis_1 is up-to-date
Creating laradock_workspace_1  ... done
Creating laradock_phpmyadmin_1 ... done
Creating laradock_php-fpm_1    ... done
Creating laradock_nginx_1      ... done
root@debian:/home/puji122/laravel-projects/laradock# 
</code></pre></div></div>
<p>Jika sudah aktif kita lanjutkan…<br />
kali ini kita aktifkan service <strong><em>workspace</em></strong> dari laradock dengan perintah berikut :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>docker-compose <span class="nb">exec </span>workspace bash
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@debian:/home/puji122/laravel-projects/laradock# docker-compose exec workspace bash
npm notice 
npm notice New minor version of npm available! 7.0.15 -&gt; 7.4.0
npm notice Changelog: https://github.com/npm/cli/releases/tag/v7.4.0
npm notice Run npm install -g npm@7.4.0 to update!
npm notice 
root@2687293dc36b:/var/www#
</code></pre></div></div>
<p>sudah terlihat yah kita sudah berada di workspace laradock kita bisa dilihat kan : <code class="language-html highlighter-rouge">root@2687293dc36b:/var/www#</code>, menandakan kita ada di direktori workspace kita.<br />
sekarang kita mulai menginstall laravel nya yah. jika kalian sudah menginstall dari artikel sebelumnya maka tidak perlu menginstall nya lagi. tapi kalau mau sama kalian boleh mengulang installasi laravelnya disini :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@04f8fe1a3732:/var/www# composer create-project laravel/laravel<span class="o">=</span>6.0 projectku <span class="nt">--prefer-dist</span>
</code></pre></div></div>
<p>kemudian kita akses direktori project laravel kita disini saya menamakan direktori nya dengan nama <strong><em>project/</em></strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@04f8fe1a3732:/var/www# <span class="nb">cd </span>projectku/
</code></pre></div></div>

<h3 id="setting-environment">Setting Environment</h3>
<p>Selanjutnya adalah setting file <strong><em>.env</em></strong> di direktori root project kita, buka file .env di code editor kita, kira-kira seperti ini setup .env gout :</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="syntax"><code>DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=projectku
DB_USERNAME=root
DB_PASSWORD=root
</code></pre></div></div>
<p>disesuaikan yah dengan settingan database kalian.</p>

<p>kembali ke terminal lagi kemudian kita buat migration nya :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@04f8fe1a3732:/var/www/projectku# php artisan make:migration create_employees_table 
</code></pre></div></div>
<p>disini gout mau buat table untuk menampung data karyawan dengan nama table <strong><em>employees</em></strong>, buka file migration yang baru dibuat tadi yang berada di direktori : <strong><em>database/migrations/</em></strong>. Kurang lebih seperti ini codingannya, otomatis laravel membuatkan 2 buah method yaitu <strong>up()</strong> dan <strong>down()</strong>, fungsi up adalah untuk meregenerate config dalam membuat sebuah table baru di database kita sementara fungsi down untuk mendestroy atau menghapus proses migration yang telah dilakukan yaitu menggunakan tools <strong><em>rollback</em></strong>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CreateEmployeesTable</span> <span class="kd">extends</span> <span class="nc">Migration</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$field</span><span class="o">=</span><span class="p">[];</span>

    <span class="cd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'employees'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">bigIncrements</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>

    <span class="p">}</span>

    <span class="cd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'employees'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>jika file migrasi diatas kita eksekusi dengan perintah berikut : 
buka terminal kembali :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@04f8fe1a3732:/var/www/projectku# php artisan migrate
</code></pre></div></div>
<p>setelah migrasi di eksekusi dengan perintah diatas, makan akan terbentuk sebuah struktur table baru di database kita, dimana di artikel ini nama database gout adalah database <strong>projectku</strong>. Coba kalian cek dengan phpmyadmin atau menggunakan mysql CLI di terminal. Sudah terlihat akan ada table baru dengan nama <strong><em>employee</em></strong>.</p>

<h4 id="selanjutnya-">Selanjutnya …</h4>
<p>Selanjutnya adalah edit table kita, asumsinya kita ingin menambahkan field atau column baru di table tersebut maka kita bisa mengubah code di file migration kita menjadi seperti ini :</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CreateEmployeesTable</span> <span class="kd">extends</span> <span class="nc">Migration</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$field</span><span class="o">=</span><span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">new</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">,</span> <span class="nv">$field</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">field</span> <span class="o">=</span> <span class="nv">$field</span><span class="p">;</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">){</span>
            <span class="k">foreach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">field</span> <span class="k">as</span> <span class="nv">$dataField</span><span class="p">)</span><span class="o">:</span>
                <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="nv">$dataField</span><span class="p">);</span>
            <span class="k">endforeach</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="cd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'employees'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">bigIncrements</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>

         <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nc">Schema</span><span class="o">::</span><span class="nf">hasColumn</span><span class="p">(</span><span class="s1">'employees'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nc">Schema</span><span class="o">::</span><span class="nf">hasColumn</span><span class="p">(</span><span class="s1">'employees'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nc">Schema</span><span class="o">::</span><span class="nf">hasColumn</span><span class="p">(</span><span class="s1">'employees'</span><span class="p">,</span> <span class="s1">'jobdesk'</span><span class="p">)){</span>
            <span class="nv">$tableName</span> <span class="o">=</span> <span class="s1">'employees'</span><span class="p">;</span>
            <span class="nv">$dataField</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">"name"</span><span class="p">,</span>
                <span class="s2">"email"</span><span class="p">,</span>
                <span class="s2">"jobdesk"</span>
            <span class="p">];</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">,</span> <span class="nv">$dataField</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'employees'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>bisa di lihat dari code tersebut, gout menambahkan method baru yaitu method <strong><em>new()</em></strong> , dimana nanti fungis dari method <strong><em>new()</em></strong> ini akan melakukan refresh migration dengan menambahkan beberapa field atau column baru.<br />
Lanjut kita lakukan fresh migration dengan perintah berikut di terminal :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@04f8fe1a3732:/var/www/projectku# php artisan migrate:fresh
</code></pre></div></div>
<p>coba lihat kembali database kita, sudah terlihat kan ada susunan field baru di table <strong><em>employees</em></strong> :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@debian:/home/puji122/laravel-projects/laradock# docker-compose <span class="nb">exec </span>mysql bash
root@c9bf0fb0acac:/# mysql <span class="nt">-u</span> root <span class="nt">-p</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>Enter password: 
Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MySQL connection <span class="nb">id </span>is 2
Server version: 5.7.32 MySQL Community Server <span class="o">(</span>GPL<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

mysql&gt; 

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>mysql&gt; show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| default            |
| mysql              |
| performance_schema |
| projectku          |
| sys                |
+--------------------+
6 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.50 sec<span class="o">)</span>
mysql&gt; use projectku<span class="p">;</span>
Reading table information <span class="k">for </span>completion of table and column names
You can turn off this feature to get a quicker startup with <span class="nt">-A</span>

Database changed
mysql&gt; 
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>mysql&gt; show tables<span class="p">;</span>
+---------------------+
| Tables_in_projectku |
+---------------------+
| books               |
| employees           |
| migrations          |
| products            |
+---------------------+
4 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

mysql&gt; describe employees<span class="p">;</span>
+------------+---------------------+------+-----+---------+----------------+
| Field      | Type                | Null | Key | Default | Extra          |
+------------+---------------------+------+-----+---------+----------------+
| <span class="nb">id</span>         | bigint<span class="o">(</span>20<span class="o">)</span> unsigned | NO   | PRI | NULL    | auto_increment |
| created_at | timestamp           | YES  |     | NULL    |                |
| updated_at | timestamp           | YES  |     | NULL    |                |
| name       | varchar<span class="o">(</span>255<span class="o">)</span>        | NO   |     | NULL    |                |
| email      | varchar<span class="o">(</span>255<span class="o">)</span>        | NO   |     | NULL    |                |
| jobdesk    | varchar<span class="o">(</span>255<span class="o">)</span>        | NO   |     | NULL    |                |
+------------+---------------------+------+-----+---------+----------------+
6 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.19 sec<span class="o">)</span>

mysql&gt;
</code></pre></div></div>

<h4 id="spesific-migrate-table">Spesific migrate table</h4>
<p>selain cara diatas adalagi cara, jika kita sudah melakukan beberapa migration sehingga file migration kita sudah banyak, ada baiknya sih tiap migration berada dalam folder atau direktori berbeda untuk tiap-tiap migrationnya.<br />
untuk spesifik table tertentu kita bisa melakukan migrate dengan perintah berikut :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="syntax"><code>root@04f8fe1a3732:/var/www/projectku# php artisan migrate <span class="nt">--path</span><span class="o">=</span>/database/migrations/2021_01_11_123821_create_employees_table.php
</code></pre></div></div>
<p>dengan menambahkan command <strong><em>–path</em></strong> kemudian di isi dengan letak file migration yang akan di eksekusi.</p>

<p>ok sekian dulu dari saya untuk artikel kali ini, nanti kita lanjutkan lagi artikel mengenai laravel di artikel selanjutnya…. see the next articles</p>

<p>bye :)</p>

<p><strong><em>Salam</em></strong></p>

<p><strong>Puji Ermanto</strong></p>
:ET