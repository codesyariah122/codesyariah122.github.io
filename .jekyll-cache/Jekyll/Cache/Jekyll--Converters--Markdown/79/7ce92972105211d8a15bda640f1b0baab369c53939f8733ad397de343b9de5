I"H<h3 id="menjalankan-dua-query-berbeda-secara-bersamaan-dalam-satu-statement">Menjalankan dua query berbeda secara bersamaan dalam satu statement</h3>

<p>masih mengenai PDOExtention seperti base method dari aplikasi crud data sederhana ajax, di artikel sebelum-sebelumnya yang pernah ada di blogg ini.<br />
ketika sebuah aplikasi semakin berkembang dinamika process data menjadi semakin komplek, ada banyak table data yang berhubungan satu dengan lainnya. Algoritma menjadi semakin komplek dibutuhkan penanganan yang praktis, cepat dan mudah dimengerti untuk selanjutnya di maintenance.</p>

<p>dalam artikel ini gout maksudkan sebagai catatan pribadi gout belaka, dimana dalam beberapa project gout yang lalu menemukan kasus, seperti :</p>

<ul>
  <li>table yang berhubungan satu sama lain
dalam kasus tersebut gout berhadapan dengan table yang terkait dengan table lainnya, di kasus tersebut ada data yang harus diinsert dan diupdate secara bersamaan, setelah berkutat di mesin google mencari solusi dan ilmu disana dimari, akhirnya gout bertemu dengan kasus dan permasalahan yang sama disebuah website sharing programmer terkenal sejagad dunia yang fana ini yaitu di stackoverflow, link nya gout sematkan di bawah ini :<br />
<a href="https://stackoverflow.com/questions/14059172/insert-into-2-tables-with-pdo-mysql" title="Crud data sederhana dengan ajax jquery">stackoverflow</a><br />
dari diskusi di forum tersebut akhirnya solved dengan code yang beberapa kali gout debugging, dan akhirnya fix menjadi seperti ini :</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">addData</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$table1</span><span class="p">,</span> <span class="nv">$table2</span><span class="p">){</span>
  <span class="nv">$dbh</span> <span class="o">=</span> <span class="nf">connect</span><span class="p">();</span>
  <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$dataExample</span><span class="p">;</span>
  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"
      INSERT INTO `</span><span class="nv">$table1</span><span class="s2">` (id1_primarykey, data_exapmple, id2_foreignkey) VALUES ('', ?, '');
  "</span><span class="p">;</span>
  <span class="nv">$insertProduct</span> <span class="o">=</span> <span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

  <span class="nv">$insertProduct</span><span class="o">-&gt;</span><span class="nf">bindParam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

  <span class="nv">$insertProduct</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
  
    <span class="c1">// update id_react table product</span>
  <span class="nv">$lastId</span> <span class="o">=</span> <span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">lastInsertId</span><span class="p">();</span>
  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"
    UPDATE `</span><span class="nv">$table1</span><span class="s2">` SET id2_foreignkey = </span><span class="nv">$lastId</span><span class="s2"> WHERE `id1_primarykey` = </span><span class="nv">$lastId</span><span class="s2">;
    INSERT INTO `</span><span class="nv">$table2</span><span class="s2">` (id2_primarykey, data) VALUES(</span><span class="nv">$lastId</span><span class="s2">, ?);
  "</span><span class="p">;</span>
  <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$dbh</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">bindParam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

  <span class="k">return</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

</code></pre></div></div>

<p>dari code diatas alhamdulillah problem gout solved, dari process pertama data dikirm ke table1 kemudian dalam process selanjutnya satu field data di table1 di update dengan mengambil <strong><em>id terakhir</em></strong> dalam kasus tersebut gout menggunakan PDOExtention dan script untuk PDO::lastInsertId(); <strong><em>perhatikan script berikut : <code class="language-plaintext highlighter-rouge">$lastId = $dbh-&gt;lastInsertId()</code></em></strong> <code class="language-plaintext highlighter-rouge">$dbh</code> itu adalah variable untu memanggil fungsi <code class="language-plaintext highlighter-rouge">connect(){}</code> yaitu sebuah fungsi untuk mengkoneksikan database. di table1 berbarengan dengan mengirim data yang berbeda ke table yang berbeda yaitu table2. dan process ini berjalan normal dan lancar. semoga coders semua yang mengalami permasalahan yang sama bisa solved juga, semoga artikel ini juga membantu bagi yang mempunyai permasalahan yang sama dengan gout. dirasa gout cukupkan artikel ini. akhir kata gout ucapkan ….</p>

<p>waasalamm….</p>

<p><strong><em>puji ermanto</em></strong></p>

:ET